(function () {
  var galleryElements = {},
      currentGallery,
      overlay,
      slider,
      previousButton,
      nextButton,
      closeButton,
      images = [],
      currentIndex = 0,
      options = {},
      defaults = {
          captions: true,
          buttons: true,
          fullScreen: false,
          noScrollbars: false,
          animation: 'fadeIn',
          overlayBackgroundColor: 'rgba(0,0,0,0.8)'
      };

  function init(selector, userOptions) {
      options = Object.assign({}, defaults, userOptions);
      galleryElements[selector] = document.querySelectorAll(selector);
      galleryElements[selector].forEach((gallery, galleryIndex) => {
          gallery.querySelectorAll('a').forEach((item, index) => {
              item.addEventListener('click', function (event) {
                  event.preventDefault();
                  openGallery(galleryIndex, index);
              });
          });
      });
  }

  function openGallery(galleryIndex, imageIndex) {
      currentGallery = galleryElements[Object.keys(galleryElements)[galleryIndex]];
      images = Array.from(currentGallery.querySelectorAll('a'));
      createOverlay();
      showImage(imageIndex);
  }

  function createOverlay() {
      if (!overlay) {
          overlay = document.createElement('div');
          overlay.id = 'baguetteBox-overlay';
          document.body.appendChild(overlay);
          slider = document.createElement('div');
          slider.id = 'baguetteBox-slider';
          overlay.appendChild(slider);
          previousButton = createButton('prev', showPreviousImage);
          nextButton = createButton('next', showNextImage);
          closeButton = createButton('close', closeGallery);
      }
      overlay.style.display = 'block';
  }

  function createButton(className, clickHandler) {
      var button = document.createElement('button');
      button.className = className;
      button.addEventListener('click', clickHandler);
      overlay.appendChild(button);
      return button;
  }

  function showImage(index) {
      if (index < 0 || index >= images.length) return;
      currentIndex = index;
      slider.innerHTML = '';
      var img = document.createElement('img');
      img.src = images[index].href;
      slider.appendChild(img);
  }

  function showPreviousImage() {
      showImage(currentIndex - 1);
  }

  function showNextImage() {
      showImage(currentIndex + 1);
  }

  function closeGallery() {
      overlay.style.display = 'none';
  }

  window.baguetteBox = {
      run: init
  };
})();
